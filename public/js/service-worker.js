self.addEventListener("install",function(a){a.waitUntil(skipWaiting())});self.addEventListener("message",function(a){});
self.addEventListener("push",function(a){var b=null;if("undefined"!==typeof a.data&&a.data){var b=a.data.text(),c=JSON.parse(b);c&&"undefined"!==typeof c.id&&(b=c)}if(null!==b){var d=_bpush_env.endpoint_base+"/sapi/v1/count_receive";fetch(d+"?"+("app_key="+_bpush_env.app_key+"&nid="+b.id)).then(function(a){console.log("receive notification")});self.registration.showNotification(b.subject,{body:b.body,tag:b.tag,icon:b.icon+"?nid="+b.id})}else d=_bpush_env.endpoint_base+"/sapi/v1/get_notification",
a.waitUntil(self.registration.pushManager.getSubscription().then(function(a){return fetch(d+"?"+("app_key="+_bpush_env.app_key+"&nid=")).then(function(a){if(200!==a.status)throw Error();return a.json().then(function(a){if(a.error||!a.notification)throw Error();a=a.notification;return self.registration.showNotification(a.subject,{body:a.body,tag:a.tag,icon:a.icon+"?nid="+a.id})})})}))});
self.addEventListener("notificationclick",function(a){a.notification.close();if("user_visible_auto_notification"!=a.notification.tag){var b=a.notification.icon.split("?")[1].split("&")[0].split("=")[1];a.waitUntil(clients.matchAll({type:"window"}).then(function(a){for(var d=0;d<a.length;d++){var c=a[d];if("/"==c.url&&"focus"in c)return c.focus()}if(clients.openWindow)return a=(0,eval)("this"),clients.openWindow(a._bpush_env.endpoint_base+"/sapi/v1/click?app_key="+a._bpush_env.app_key+"&nid="+b)}))}});
self.addEventListener("activate",function(a){a.waitUntil(self.clients.claim())});
